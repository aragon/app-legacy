import{y as d,q as e,Z as ve,B as se,u as N,D as jt,w as ie,t as pe,g as qe,F as de,G as E,e as K,I as P,z as M,J as Ot,N as Vt,h as Ce,f as ze,O as Lt,Q as It,R as vt,T as Mt,U as ke,V as Ie,W as Me,X as yt,Y as he,_ as Wt,$ as Rt,a0 as F,a1 as We,a2 as tt,a3 as Ae,a4 as _t,a5 as Ft,a6 as Pt,a7 as $t,a8 as Ht,a9 as Gt,aa as Bt,ab as Ke,ac as Ut,ad as qt,ae as zt,af as st,ag as Be,ah as xe,p as At,ai as Kt,aj as at,ak as Xt,al as ge,am as Xe,an as Ze,A as X,ao as Je,ap as me,aq as Ye,ar as Y,as as R,at as ue,au as Qe,av as Zt,aw as nt,ax as it,ay as Jt,az as Yt,aA as Qt,aB as es,aC as ne,aD as Ue,aE as rt,aF as lt,aG as ts,aH as ot,aI as ss,aJ as we,aK as as,aL as ns,aM as is,aN as rs,aO as ae,aP as be}from"./main-1e616d6f.js";import{r as j}from"./tiptap-313d156f.js";import{u as fe,D as Te,a as C,b as S,c as T,F as ls}from"./index-5413d03b.js";import{F as ct,T as os,S as ce}from"./index-9717678c.js";import{E as cs,D as ds,C as ms}from"./index-482f0b49.js";import{S as us,A as ps,I as xs}from"./index-d73e132f.js";import{F as hs}from"./index-ed07b3e9.js";import{u as gs}from"./usePendingDao-353bf14a.js";import{C as bs}from"./committee-c8ac830b.js";import{a7 as ks}from"./osx-ethers-780b73f3.js";import{M as fs,g as js}from"./index-4cbd21fe.js";import"./index-b80a0dc5.js";import"./accordionSummary-a06aa21e.js";const ye=({imgSrc:t,caption:l,title:i,subtitle:r})=>e.jsxs(vs,{children:[e.jsx(ys,{children:t}),e.jsxs(As,{children:[e.jsx(ws,{children:l}),e.jsx(Cs,{children:i}),e.jsx(Ts,{children:r})]})]}),vs=d.div.attrs({className:"flex-1 p-6 rounded-xl bg-neutral-0 mx-2 mb-6 xl:m-0"})``,ys=d.div.attrs({className:"mb-4 rounded-xl flex justify-center bg-neutral-50"})``,As=d.div.attrs({className:"space-y-0.5"})``,ws=d.div.attrs({className:"text-sm leading-normal text-neutral-500"})``,Cs=d.div.attrs({className:"font-semibold text-neutral-800"})``,Ts=d.div.attrs({className:"text-sm leading-normal text-neutral-600"})``,Ns=({navLabel:t,returnPath:l,onExitButtonClick:i})=>{const{t:r}=N(),{next:a}=fe(),n=()=>{de("daoCreation_setupDAO_clicked"),a()};return e.jsxs("div",{className:"bg-neutral-0 p-4 md:rounded-xl md:p-12",children:[e.jsx("div",{className:"mb-6 xl:hidden",children:e.jsx(jt,{crumbs:{label:t,path:l},onClick:i})}),e.jsxs("div",{className:"items-end md:flex md:space-x-12",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("h1",{className:"font-semibold text-neutral-800 ft-text-3xl",children:r("createDAO.overview.title")}),e.jsx("p",{className:"mt-4 text-neutral-600 ft-text-lg",children:r("createDAO.overview.description")})]}),e.jsx("div",{className:"mt-4 flex space-x-4 md:mt-0",children:e.jsx(ie,{size:"lg",variant:"primary",className:"w-full whitespace-nowrap md:w-max",iconRight:pe.CHEVRON_RIGHT,onClick:n,children:r("createDAO.overview.button")})})]})]})},dt=[e.jsx(ye,{imgSrc:e.jsx(ve,{object:"CHAIN"}),caption:se.t("createDAO.step1.label"),title:se.t("createDAO.step1.title")},"SelectBlockchain"),e.jsx(ye,{imgSrc:e.jsx(ve,{object:"LABELS"}),caption:se.t("createDAO.step2.label"),title:se.t("createDAO.step2.title")},"DefineMetadata"),e.jsx(ye,{imgSrc:e.jsx(ve,{object:"USERS"}),caption:se.t("createDAO.step3.label"),title:se.t("createDAO.step3.title")},"SetupCommunity"),e.jsx(ye,{imgSrc:e.jsx(ve,{object:"SETTINGS"}),caption:se.t("createDAO.step4.label"),title:se.t("createDAO.step4.shortTitle")},"ConfigureGovernance")],Ds=()=>{const{isDesktop:t}=qe();return t?e.jsx("div",{className:"space-y-6 md:flex md:space-x-6 md:space-y-0",children:dt}):e.jsx(Ss,{children:e.jsx(us,{swipeable:!0,emulateTouch:!0,centerMode:!0,autoPlay:!0,preventMovementUntilSwipeScrollTolerance:!0,swipeScrollTolerance:100,interval:4e3,showArrows:!1,showStatus:!1,transitionTime:300,centerSlidePercentage:92,showThumbs:!1,infiniteLoop:!0,renderIndicator:(l,i,r,a)=>i?e.jsx(ps,{"aria-label":`Selected: ${a} ${r+1}`,title:`Selected: ${a} ${r+1}`}):e.jsx(xs,{onClick:l,onKeyDown:l,value:r,role:"button",tabIndex:0,title:`${a} ${r+1}`,"aria-label":`${a} ${r+1}`},r),children:dt})})},Ss=d.div.attrs({className:"mb-10 -mx-4 md:-mx-6 xl:mx-0"})``,Es=()=>{const{control:t,getValues:l}=E(),{setStep:i}=fe(),{network:r}=K(),{blockchain:a,reviewCheckError:n}=l(),{t:o}=N(),x=M[r].isTestnet?o("labels.testNet"):o("labels.mainNet");return e.jsx(P,{name:"reviewCheck.blockchain",control:t,defaultValue:!1,rules:{required:o("errors.required.recipient")},render:({field:{onChange:s,value:p}})=>e.jsxs(Te,{title:o("labels.review.blockchain"),onEditClick:()=>i(2),checkBoxErrorMessage:o("createDAO.review.acceptContent"),checkedState:p?"active":n?"error":"default",tagLabel:o("labels.notChangeable"),onChecked:()=>s(!p),children:[e.jsxs(C,{children:[e.jsx(S,{children:o("labels.review.network")}),e.jsx(T,{children:x})]}),e.jsxs(C,{children:[e.jsx(S,{children:o("labels.review.blockchain")}),e.jsx(T,{children:a.label})]})]})})},Os=()=>{const{control:t,getValues:l}=E(),{setStep:i}=fe(),{isL2Network:r}=K(),{t:a}=N(),{daoLogo:n,daoName:o,daoEnsName:c,daoSummary:x,links:s,reviewCheckError:p}=l();return e.jsx(P,{name:"reviewCheck.daoMetadata",control:t,defaultValue:!1,rules:{required:a("errors.required.recipient")},render:({field:{onChange:h,value:g}})=>e.jsxs(Te,{title:a("labels.review.daoMetadata"),onEditClick:()=>i(3),checkBoxErrorMessage:a("createDAO.review.acceptContent"),checkedState:g?"active":p?"error":"default",tagLabel:a("labels.changeableVote"),onChecked:()=>h(!g),children:[e.jsxs(C,{children:[e.jsx(S,{children:a("labels.logo")}),e.jsx(T,{children:e.jsx(Ot,{daoName:o,...n&&{src:URL.createObjectURL(n)},size:"small"})})]}),e.jsxs(C,{children:[e.jsx(S,{children:a("labels.daoName")}),e.jsx(T,{children:o})]}),!r&&e.jsxs(C,{children:[e.jsx(S,{children:a("labels.daoEnsName")}),e.jsx(T,{children:`${c}.dao.eth`})]}),e.jsxs(C,{children:[e.jsx(S,{children:a("labels.summary")}),e.jsx(T,{children:x})]}),s[0].url!==""&&e.jsxs(C,{children:[e.jsx(S,{children:a("labels.links")}),e.jsx(T,{children:e.jsx("div",{className:"space-y-3",children:s.map(({name:b,url:m},v)=>m!==""&&e.jsx(Vt,{label:b,href:m,external:!0},v))})})]})]})})},Vs=()=>{const{getValues:t}=E(),{isOpen:l,close:i}=Ce("addresses"),[r,a,n]=t(["wallets","tokenSymbol","multisigWallets"]),{network:o}=K(),c=ze(),{dao:x}=Lt();return e.jsx(It,{isOpen:l,onClose:i,"data-testid":"communityModal",children:e.jsx(hs,{wallets:a?r:n,tokenSymbol:a,onVoterClick:s=>{x?c(vt(Mt,{network:o,dao:x,user:s})):window.open(`${M[o].explorer}address/${s}`,"_blank")}})})},Ls=()=>{const{control:t,getValues:l}=E(),{setStep:i}=fe(),{open:r}=Ce(),{t:a}=N(),{network:n}=K(),{membership:o,tokenName:c,tokenType:x,wallets:s,isCustomToken:p,tokenSymbol:h,tokenAddress:g,tokenTotalSupply:b,tokenTotalHolders:m,multisigWallets:v,reviewCheckError:D,eligibilityType:k,eligibilityTokenAmount:u,votingType:f}=l(),y=!p&&x==="ERC-20"&&f!=="gasless",w=y?yt(h):h,A=j.useMemo(()=>b>1e14?"> 100t":ke(b).format(b<100?"0,0.[000]":"0,0"),[b]),W=j.useMemo(()=>m?m>1e14?"> 100t":ke(m).format("0,0"):"-",[m]);return e.jsx(P,{name:"reviewCheck.community",control:t,defaultValue:!1,rules:{required:a("errors.required.recipient")},render:({field:{onChange:B,value:J}})=>e.jsxs(Te,{title:a("labels.review.voters"),onEditClick:()=>i(4),checkBoxErrorMessage:a("createDAO.review.acceptContent"),checkedState:J?"active":D?"error":"default",tagLabel:a("labels.changeableVote"),onChecked:()=>B(!J),children:[e.jsxs(C,{children:[e.jsx(S,{children:a("labels.review.eligibleVoters")}),e.jsx(T,{children:a(o==="token"?"createDAO.step3.tokenMembership":"labels.multisigMembers")})]}),o==="multisig"&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx(S,{children:a("labels.review.distribution")}),e.jsx(T,{children:e.jsx(Ie,{label:a("labels.review.distributionLink",{walletCount:v.length}),onClick:()=>r("addresses")})})]}),e.jsxs(C,{children:[e.jsx(S,{children:a("labels.proposalCreation")}),e.jsx(T,{children:a(k==="anyone"?"labels.anyWallet":"labels.multisigMembers")})]})]}),o==="token"&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx(S,{children:a("votingTerminal.token")}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{children:[y&&e.jsxs("span",{children:[a("labels.review.tokenSymbolGovernance")," "]}),e.jsxs("span",{children:[c," (",w,")"]})]}),p&&e.jsx(Me,{label:a("labels.new"),variant:"info"}),y&&e.jsx(Me,{label:a("labels.review.tokenWrapped"),variant:"info"})]})})]}),!y&&e.jsxs(C,{children:[e.jsx(S,{children:a("labels.supply")}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("p",{children:[A," ",h]}),p&&e.jsx(Me,{label:a("labels.mintable"),variant:"neutral"})]})})]}),!p&&!y&&e.jsxs(C,{children:[e.jsx(S,{children:a("labels.review.existingTokens.currentHolders")}),e.jsx(T,{children:e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("p",{children:W})})})]}),y&&e.jsxs(C,{children:[e.jsx(S,{children:a("labels.supplyPotential")}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:[A," ",w]}),e.jsx("div",{className:"text-neutral-400 ft-text-sm",children:a("labels.supplyPotentialHelptext",{tokenSymbol:h})})]})})]}),e.jsxs(C,{children:[e.jsx(S,{children:a("labels.review.distribution")}),e.jsx(T,{children:p?e.jsx(Ie,{label:a("createDAO.review.distributionLink",{count:s?.length}),onClick:()=>r("addresses")}):e.jsx(Ie,{label:a("labels.review.distributionLinkLabel"),href:M[n].explorer+"/token/tokenholderchart/"+g?.address||g,iconRight:pe.LINK_EXTERNAL,external:!0})})]}),e.jsxs(C,{children:[e.jsx(S,{children:a("labels.proposalCreation")}),e.jsx(T,{children:k==="token"?a("createDAO.review.proposalCreation",{token:u,symbol:w}):a("createDAO.step3.eligibility.anyWallet.title")})]})]}),e.jsx(Vs,{})]})})},Is=()=>{const{control:t,getValues:l}=E(),{setStep:i}=fe(),{t:r}=N(),{minimumApproval:a,minimumParticipation:n,tokenTotalSupply:o,tokenSymbol:c,durationMinutes:x,durationHours:s,durationDays:p,reviewCheckError:h,earlyExecution:g,voteReplacement:b,membership:m,multisigMinimumApprovals:v,multisigWallets:D,isCustomToken:k,tokenType:u,votingType:f}=l(),y=!k&&u==="ERC-20";return e.jsx(P,{name:"reviewCheck.governance",control:t,defaultValue:!1,rules:{required:r("errors.required.recipient")},render:({field:{onChange:w,value:A}})=>e.jsxs(Te,{title:r("labels.review.votingParameters"),onEditClick:()=>i(5),checkBoxErrorMessage:r("createDAO.review.acceptContent"),checkedState:A?"active":h?"error":"default",tagLabel:r("labels.changeableVote"),onChecked:()=>w(!A),children:[m==="multisig"&&e.jsxs(C,{children:[e.jsx(S,{children:r("labels.minimumApproval")}),e.jsx(T,{children:r("labels.review.multisigMinimumApprovals",{count:v,total:D.length})})]}),m==="token"&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx(S,{children:r("labels.supportThreshold")}),e.jsxs(T,{children:[">",parseInt(a),"%"]})]}),e.jsxs(C,{children:[e.jsx(S,{children:r("labels.minimumParticipation")}),e.jsxs(T,{children:["≥",n,"%",!y&&e.jsxs("span",{children:["(",Math.ceil(o*(A/100))<o?"≥":"",Math.ceil(o*(n/100))," ",c,")"]})]})]}),e.jsxs(C,{children:[e.jsx(S,{children:r("labels.minimumDuration")}),e.jsx(T,{children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{children:r("createDAO.review.days",{days:p})}),e.jsx("div",{children:r("createDAO.review.hours",{hours:s})}),e.jsx("div",{children:r("createDAO.review.minutes",{minutes:x})})]})})]}),f==="onChain"&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx(S,{children:r("labels.earlyExecution")}),e.jsx(T,{children:r(g?"labels.yes":"labels.no")})]}),e.jsxs(C,{children:[e.jsx(S,{children:r("labels.voteReplacement")}),e.jsx(T,{children:r(b?"labels.yes":"labels.no")})]})," "]})]})]})})},Ms=""+new URL("goLive-2046032a.svg",import.meta.url).href,Re=18,wt=j.createContext(null),Ws=({children:t})=>{const{open:l}=Ce(),i=ze(),{isOnWrongNetwork:r,provider:a}=he(),{network:n}=K(),{t:o}=N(),{getValues:c}=E(),{client:x}=Wt(),s=Rt(),p=gs(),[h,g]=j.useState(),[b,m]=j.useState(),[v,D]=j.useState(!1),[k,u]=j.useState(""),f=b!==void 0&&h===F.WAITING,y=async()=>{g(F.LOADING),D(!0);const V=await Ne();m(V),g(F.WAITING)},w=async()=>{if(de("daoCreation_publishDAONow_clicked",{network:c("blockchain")?.network,wallet_provider:a?.connection.url,governance_type:c("membership"),estimated_gwei_fee:ee?.toString(),total_usd_cost:ee?(je*Number(ee)).toString():"0"}),h===F.SUCCESS){A();return}if(!b||h===F.LOADING){console.log("Transaction is running");return}if(r){l("network"),A();return}await Tt()},A=()=>{switch(h){case F.LOADING:break;case F.SUCCESS:i(vt(qt,{network:n,dao:k})),n==="ethereum"&&l("poapClaim");break;default:D(!1),Ee()}},W=j.useCallback(()=>{const{blockchain:V,multisigWallets:$,multisigMinimumApprovals:H,eligibilityType:_}=c();return[{members:$.map(G=>G.address),votingSettings:{minApprovals:H,onlyListed:_==="multisig"}},mt(V.id)]},[c]),B=j.useCallback(()=>{const{blockchain:V,minimumApproval:$,minimumParticipation:H,durationDays:_,durationHours:G,durationMinutes:q,eligibilityType:Z,eligibilityTokenAmount:te,voteReplacement:le,earlyExecution:U,isCustomToken:L,tokenDecimals:I}=c();let z;le?z=We.VOTE_REPLACEMENT:U?z=We.EARLY_EXECUTION:z=We.STANDARD;let oe=Re;return L||(oe=I),[{minDuration:tt(parseInt(_),parseInt(G),parseInt(q)),minParticipation:parseInt(H)/100,supportThreshold:parseInt($)/100,minProposerVotingPower:Z==="token"&&te!==void 0?Ae.parseUnits(te.toString(),oe).toBigInt():Z==="multisig"||Z==="anyone"?BigInt(0):Ae.parseUnits("1",oe).toBigInt(),votingMode:z},mt(V.id)]},[c]),J=j.useCallback(()=>{const{tokenName:V,tokenSymbol:$,wallets:H}=c();return{name:V,symbol:$,decimals:Re,balances:H?.map(_=>({address:_.address,balance:Ae.parseUnits(_.amount,Re).toBigInt()}))}},[c]),re=j.useCallback(()=>{const{tokenAddress:V,tokenName:$,tokenSymbol:H,tokenType:_}=c();let G,q;return _==="ERC-20"?(G=`Governance ${$}`,q=`g${H}`):(G=$,q=H),{tokenAddress:V.address,wrappedToken:{name:G,symbol:q}}},[c]),Q=j.useCallback(V=>{const{isCustomToken:$,committee:H,tokenType:_,committeeMinimumApproval:G,executionExpirationHours:q,executionExpirationDays:Z,executionExpirationMinutes:te}=c(),le={minTallyDuration:tt(parseInt(Z),parseInt(q),parseInt(te)),minTallyApprovals:Number(G),minDuration:V.minDuration,minParticipation:V.minParticipation,supportThreshold:V.supportThreshold,minProposerVotingPower:V.minProposerVotingPower,censusStrategy:""};return{multisig:H.map(U=>U.address),votingSettings:le,...(_==="governance-ERC20"||_==="ERC-20")&&!$?{useToken:re()}:{newToken:J()}}},[re,J,c]),Ne=j.useCallback(async()=>{const{membership:V,daoName:$,daoEnsName:H,daoSummary:_,daoLogo:G,tokenType:q,isCustomToken:Z,links:te,votingType:le}=c(),U=[];switch(V){case"multisig":{const[I,z]=W(),oe=Pt.encoding.getPluginInstallItem(I,z);U.push(oe);break}case"token":{const[I,z]=B();if(le==="gasless"){const St=Q(I),Et=_t.encoding.getPluginInstallItem(St,z);U.push(Et);break}const oe=Ft.encoding.getPluginInstallItem({votingSettings:I,...(q==="governance-ERC20"||q==="ERC-20")&&!Z?{useToken:re()}:{newToken:J()}},z);U.push(oe);break}default:throw new Error(`Unknown dao type: ${V}`)}const L={name:$,description:_,links:te.filter(I=>I.name&&I.url)};if(G)try{const I=await $t(G),z=await x?.ipfs.add(new Uint8Array(I));await x?.ipfs.pin(z),L.avatar=`ipfs://${z}`}catch{L.avatar=void 0}try{const I=await x?.ipfs.add(JSON.stringify(L));return await x?.ipfs.pin(I),{metadataUri:`ipfs://${I}`,ensSubdomain:H||"",plugins:[...U]}}catch(I){throw g(F.ERROR),console.error("Could not pin metadata on IPFS",I),I}},[x?.ipfs,re,Q,W,J,c,B]),De=j.useCallback(async()=>{if(b)return x?.estimation.createDao(b)},[x?.estimation,b]),{tokenPrice:je,maxFee:Se,averageFee:ee,stopPolling:Ee,error:Oe}=Ht(De,f),O=c("blockchain")?.id,[Ve,Le]=c(["membership","votingType"]),{createToken:et}=Gt({chainId:O,pluginType:Ve==="token"&&Le==="gasless"?zt:void 0}),Tt=async()=>{if(g(F.LOADING),!x||!b)throw new Error("SDK client is not initialized correctly");const V=x?.methods.createDao(b);if(!V)throw new Error("deposit function is not initialized correctly");const{daoName:$,daoSummary:H,daoLogo:_,links:G,votingType:q,membership:Z,isCustomToken:te,tokenAddress:le}=c(),U={name:$,description:H,avatar:_?URL.createObjectURL(_):void 0,links:G.filter(L=>L.name&&L.url)};try{for await(const L of V)switch(L.key){case st.CREATING:console.log(L.txHash),de("daoCreation_transaction_signed",{network:c("blockchain")?.network,wallet_provider:a?.connection.url,governance_type:c("membership")});break;case st.DONE:console.log("Newly created DAO address",L.address.toLowerCase()),de("daoCreation_transaction_success",{network:c("blockchain")?.network,wallet_provider:a?.connection.url,governance_type:c("membership")}),m(void 0),g(F.SUCCESS),u(L.address.toLowerCase());try{await Promise.all([p.mutateAsync({daoAddress:L.address.toLowerCase(),network:n,daoDetails:{...b,metadata:U,creationDate:new Date}}),s.mutateAsync({dao:{address:L.address.toLocaleLowerCase(),chain:M[n].id,ensDomain:b.ensSubdomain||"",plugins:[{id:Z==="token"?"token-voting.plugin.dao.eth":"multisig.plugin.dao.eth",data:b.plugins[0].data}],metadata:{name:U.name,avatar:U.avatar,description:U.description}}})]).then(async()=>{q==="gasless"&&Z==="token"&&(te?await et(L.pluginAddresses[0]):await et(L.pluginAddresses[0],le?.address))})}catch(I){console.warn("Error favoriting and adding newly created DAO to cache",I)}break}}catch(L){console.log(L),de("daoCreation_transaction_failed",{network:c("blockchain")?.network,wallet_provider:a?.connection.url,governance_type:c("membership"),err:L}),g(F.ERROR)}},Nt={[F.SUCCESS]:o("TransactionModal.launchDaoDashboard"),[F.WAITING]:o("TransactionModal.publishDaoButtonLabel")},Dt=b==null&&h!==F.SUCCESS?y:w;return e.jsxs(wt.Provider,{value:{handlePublishDao:y},children:[t,e.jsx(Bt,{subtitle:o("TransactionModal.publishDaoSubtitle"),buttonStateLabels:Nt,state:h||F.WAITING,isOpen:v,onClose:A,callback:Dt,closeOnDrag:h!==F.LOADING,maxFee:Se,averageFee:ee,gasEstimationError:Oe,tokenPrice:je})]})};function Rs(){return j.useContext(wt)}function mt(t){const l=Ke(t);if(l)return Ut(l);throw new Error("No network selected. A supported network must be selected")}const _s=()=>{const{t}=N(),l=ze(),i=r=>{l(r)};return e.jsxs("div",{className:"bg-neutral-0 px-4 pb-6 pt-4 md:rounded-xl md:p-6 xl:p-12 xl:pt-6",children:[e.jsx("div",{className:"xl:hidden",children:e.jsx(jt,{crumbs:{label:t("createDAO.title"),path:Be},onClick:i})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"w-full pt-6",children:[e.jsx("h1",{className:"text-4xl font-semibold leading-tight text-neutral-800",children:t("createDAO.review.title")}),e.jsx("p",{className:"mt-4 text-xl leading-normal text-neutral-600",children:t("createDAO.review.description")})]}),e.jsx(Hs,{src:Ms})]})]})},Fs=()=>{const{t}=N(),{getValues:l}=E(),{votingType:i}=l();return e.jsxs($s,{children:[e.jsx(Es,{}),e.jsx(Os,{}),e.jsx(Ls,{}),e.jsx(Is,{}),i==="gasless"&&e.jsx(bs,{}),e.jsx(xe,{message:t("createDAO.review.daoUpdates"),variant:"info"})]})},Ps=()=>{const{watch:t,setValue:l,getValues:i}=E(),{reviewCheck:r}=t(),{t:a}=N(),{handlePublishDao:n}=Rs(),{open:o}=Ce(),{isConnected:c,provider:x,isOnWrongNetwork:s}=he(),p=()=>!Object.values(r).every(b=>b===!0),h=b=>{b.stopPropagation(),c&&de("daoCreation_publishYourDAO_clicked",{network:i("blockchain")?.network,wallet_provider:x?.connection.url,governance_type:i("membership")}),c?s?o("network"):n():o("wallet")},g=()=>{p()&&l("reviewCheckError",!0)};return e.jsx("div",{className:"flex justify-center pt-6",children:e.jsx("div",{onClick:g,children:e.jsx(ie,{size:"lg",variant:"primary",iconRight:pe.CHEVRON_RIGHT,onClick:h,disabled:p(),children:a("createDAO.review.title")})})})},$s=d.div.attrs({className:"md:mx-auto md:w-3/4 space-y-10"})``,Hs=d.img.attrs({className:"w-[200px] hidden md:block"})``,Gs=()=>{const{t}=N(),{setNetwork:l,network:i}=K(),{control:r,resetField:a}=E(),[n,o]=j.useState(M[i].isTestnet?"test":"main"),c=zs[n].popularity.filter(s=>At.getValue(`VITE_FEATURE_FLAG_${s.replace(/-/g,"_").toUpperCase()}`)!=="false"),x=s=>{s&&o(s)};return e.jsxs(e.Fragment,{children:[e.jsx(Bs,{children:e.jsx(Us,{children:e.jsxs(Kt,{isMultiSelect:!1,value:n,onChange:x,children:[e.jsx(at,{value:"main",label:t("labels.mainNet")}),e.jsx(at,{value:"test",label:t("labels.testNet")})]})})}),e.jsx(qs,{children:c.map(s=>e.jsx(P,{name:"blockchain",rules:{required:!0},control:r,render:({field:p})=>e.jsx(Xt,{onClick:()=>{l(s),p.onChange({id:M[s].id,label:M[s].name,network:n}),M[s].supportsEns||a("daoEnsName")},selected:M[s].id===p.value.id,...M[s]})},s))})]})},Bs=d.div.attrs({className:"flex justify-between"})``,Us=d.div.attrs({className:"flex p-1 space-x-1"})``,qs=d.div.attrs({className:"space-y-3"})``,zs={main:{cost:["polygon","base","arbitrum","ethereum"],popularity:["ethereum","polygon","arbitrum","base"],security:["ethereum","base","arbitrum","polygon"]},test:{cost:["sepolia"],popularity:["sepolia"],security:["sepolia"]}},Ks=({index:t,walletFieldName:l,...i})=>{const{t:r}=N(),{alert:a}=ge(),{isMobile:n}=qe(),{api:o}=Xe(),{control:c,trigger:x}=E(),s=async(p,h)=>{const g=new Je(o,p?.address,p?.ensName);return i.validator(g,h)};return e.jsxs(Xs,{children:[n&&e.jsx(Ys,{children:r("labels.whitelistWallets.address")}),e.jsx(P,{name:`${l}.${t}`,defaultValue:{address:"",ensName:""},control:c,rules:{validate:p=>s(p,t)},render:({field:{onChange:p,value:h,onBlur:g,ref:b},fieldState:{error:m}})=>e.jsxs(Zs,{children:[e.jsx(Js,{children:e.jsx(Ze,{state:m&&"critical",value:h,onBlur:g,onChange:p,error:m?.message,resolveLabels:"onBlur",ref:b,onClearButtonClick:()=>{a(r("alert.chip.inputCleared")),setTimeout(()=>{x(l)},50)}})}),e.jsxs(X.Container,{align:"start",customTrigger:e.jsx(ie,{size:"lg",variant:"tertiary",iconLeft:pe.DOTS_VERTICAL,"data-testid":"trigger"}),children:[e.jsx(X.Item,{onClick:()=>{i.onResetEntry(t),a(r("alert.chip.resetAddress"))},children:r("labels.whitelistWallets.resetEntry")}),e.jsx(X.Item,{onClick:()=>{i.onDeleteEntry(t),a(r("alert.chip.removedAddress"))},children:r("labels.whitelistWallets.deleteEntry")})]})]})})]})},Xs=d.div.attrs(()=>({className:"gap-1 flex flex-col xl:px-6 xl:py-3 p-4"}))``,Zs=d.div.attrs(()=>({className:"flex gap-4 items-start"}))``,Js=d.div.attrs(()=>({className:"flex flex-col gap-2 flex-1"}))``,Ys=d.div.attrs(()=>({className:"text-neutral-800 font-semibold ft-text-base"}))``,Ct=({controlledWallets:t,handleAdd:l,handleDeleteEntry:i,handleDeleteAll:r,rowValidator:a,walletFieldName:n})=>{const{isMobile:o}=qe(),{t:c}=N(),{control:x,trigger:s}=E(),{alert:p}=ge(),{update:h}=me({control:x,name:n}),g=m=>{h(m,{address:"",ensName:""}),p(c("alert.chip.resetAddress")),s(n)},b=()=>{t.forEach((m,v)=>{v>0&&h(v,{address:"",ensName:""})}),p(c("alert.chip.resetAllAddresses")),s("multisigWallets")};return e.jsxs(Qs,{children:[!o&&e.jsx(ea,{children:e.jsx(_e,{children:c("labels.whitelistWallets.address")})}),t.map((m,v)=>e.jsxs("div",{children:[(!o||o&&v!==0)&&e.jsx(Fe,{}),e.jsx(Ks,{index:v,onResetEntry:g,onDeleteEntry:i,validator:a,walletFieldName:n})]},m.id)),e.jsx(Fe,{}),e.jsxs(sa,{children:[e.jsx(aa,{children:e.jsx(ie,{variant:"tertiary",size:"lg",onClick:l,children:c("labels.whitelistWallets.addAddress")})}),e.jsxs(X.Container,{align:"start",customTrigger:e.jsx(ie,{size:"lg",variant:"tertiary",iconLeft:pe.DOTS_VERTICAL,"data-testid":"trigger"}),children:[e.jsx(X.Item,{onClick:b,children:c("labels.whitelistWallets.resetAllEntries")}),e.jsx(X.Item,{onClick:r,children:c("labels.whitelistWallets.deleteAllEntries")})]})]}),e.jsx(Fe,{}),e.jsxs(na,{children:[e.jsx(_e,{children:c("labels.summary")}),e.jsxs(ia,{children:[e.jsx(ta,{children:c("labels.whitelistWallets.totalWallets")}),e.jsx(_e,{children:t.length})]})]})]})},Qs=d.div.attrs(()=>({className:"rounded-xl bg-neutral-0 flex flex-col"}))``,ea=d.div.attrs(()=>({className:"mx-6 mt-6 mb-3"}))``,_e=d.p.attrs({className:"ft-text-base xl:font-semibold font-semibold text-neutral-800"})``,ta=d.p.attrs({className:"ft-text-base  text-neutral-600"})``,Fe=d.div.attrs(()=>({className:"flex bg-neutral-50 h-0.5"}))``,sa=d.div.attrs(()=>({className:"flex xl:px-6 xl:py-3 p-4 place-content-between"}))``,aa=d.div.attrs(()=>({className:"flex gap-4"}))``,na=d.div.attrs(()=>({className:"flex xl:p-6 p-4 flex-col space-y-3"}))``,ia=d.div.attrs(()=>({className:"flex place-content-between"}))``,ra=()=>{const{t}=N(),{alert:l}=ge(),i=j.useRef(!0),{network:r}=K(),{address:a}=he(),{data:n}=Ye({address:a,chainId:M[r].id}),{control:o,trigger:c,setFocus:x}=E(),s=Y({name:"multisigWallets",control:o}),{fields:p,replace:h,append:g,remove:b}=me({control:o,name:"multisigWallets"}),m=p.map((f,y)=>({...f,...s&&{...s[y]}}));j.useEffect(()=>{a&&m?.length===0&&i.current===!0&&(g({address:a,ensName:n}),i.current=!1)},[a,g,m?.length,n]);const v=()=>{g({address:"",ensName:""}),l(t("alert.chip.addressAdded"));const f=`multisigWallets.${m.length}`;setTimeout(()=>{x(f),c(f)},50)},D=f=>{b(f),l(t("alert.chip.removedAddress")),setTimeout(()=>{c("multisigWallets")},50)},k=()=>{h([{address:a}]),l(t("alert.chip.removedAllAddresses")),setTimeout(()=>{c("multisigWallets")},50)},u=async(f,y)=>{let w=await Qe(f,t("errors.required.walletAddress"),t);return s&&s.forEach(({address:A,ensName:W},B)=>{(A===f.address||W===f.ensName)&&B!==y&&(w=t("errors.duplicateAddress"))}),w};return e.jsxs(la,{children:[e.jsx(oa,{children:e.jsx(R,{label:t("createDAO.step3.multisigMembers"),helpText:t("createDAO.step3.multisigMembersHelptext"),renderHtml:!0})}),e.jsx(Ct,{controlledWallets:m,handleAdd:v,handleDeleteEntry:D,handleDeleteAll:k,rowValidator:u,walletFieldName:"multisigWallets"}),e.jsx(ue,{message:t("createDAO.step3.multisigMembersWalletAlert"),variant:"info"})]})},la=d.div.attrs(()=>({className:"space-y-3 flex flex-col"}))``,oa=d.div.attrs(()=>({className:"space-y-1 flex flex-col"}))``,ca=({tokenAddress:t})=>{const{t:l}=N(),{control:i,setValue:r,resetField:a}=E(),[n,o,c,x,s,p]=Y({name:["tokenName","tokenSymbol","tokenTotalSupply","tokenTotalHolders","tokenType","votingType"],control:i}),{network:h}=K(),{data:g,isLoading:b}=Zt({tokenAddress:t,network:h});j.useEffect(()=>{g&&(a("tokenTotalHolders"),r("tokenTotalHolders",g.holders.totalHolders))},[a,r,g]),j.useEffect(()=>{s==="governance-ERC20"&&r("eligibilityTokenAmount",1)},[s,r]);const m=j.useMemo(()=>{switch(s){case"ERC-20":return p==="gasless"?e.jsx(xe,{variant:"success",message:l("createDAO.step3.existingToken.verificationAlertSuccessTitle"),description:l("createDAO.step3.existingToken.vocdoni.verificationAlertSuccessDescription")}):e.jsx(xe,{variant:"warning",message:l("createDAO.step3.existingToken.verificationAlertWarningTitle"),description:l("createDAO.step3.existingToken.verificationAlertWarningDescription",{tokenSymbol:o,gTokenSymbol:yt(o)})});case"governance-ERC20":return e.jsx(xe,{variant:"success",message:l("createDAO.step3.existingToken.verificationAlertSuccessTitle"),description:l("createDAO.step3.existingToken.verificationAlertSuccessDescription")});case"ERC-1155":case"ERC-721":return e.jsx(xe,{variant:"critical",message:l("createDAO.step3.existingToken.verificationAlertCriticalTitle"),description:l("createDAO.step3.existingToken.verificationAlertCriticalDescription")});case"Unknown":return e.jsx(xe,{variant:"critical",message:l("createDAO.step3.existingToken.verificationAlertCriticalTitle"),description:l("createDAO.step3.existingToken.verificationAlertCriticalDescription")});default:return null}},[l,o,s,p]),v=j.useMemo(()=>{if(c<100)return ke(c).format("0,0.[000]");if(c>1e14)return"> 100t";const k=c.toLocaleString("fullwide",{useGrouping:!1});return ke(k).format("0.[00]a")},[c]),D=j.useMemo(()=>{if(!x)return"-";if(x>1e14)return"> 100t";const k=x.toLocaleString("fullwide",{useGrouping:!1});return ke(k).format("0.[00]a")},[x]);return s?e.jsx(da,{children:e.jsxs(ut,{children:[e.jsx(pt,{children:n!==""&&s!=="Unknown"?`${n} (${o})`:nt(t)}),e.jsxs(ua,{children:[e.jsxs(C,{children:[e.jsx(Pe,{children:l("createDAO.step3.existingToken.verificationLabelStandard")}),e.jsx(T,{children:s==="governance-ERC20"?"ERC-20":s})]}),s!=="Unknown"&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx(Pe,{children:l("createDAO.step3.existingToken.verificationLabelSupply")}),e.jsxs(T,{children:[v," ",o]})]}),e.jsxs(C,{children:[e.jsx(Pe,{children:l("createDAO.step3.existingToken.verificationLabelHolders")}),b?e.jsx("dd",{className:"flex items-center",style:{width:"70%"},children:e.jsx(it,{size:"sm",variant:"primary"})}):e.jsx(T,{children:D})]})]})]}),m]})}):e.jsxs(ut,{children:[e.jsx(pt,{children:nt(t)}),e.jsxs(ma,{children:[e.jsx(it,{size:"sm",variant:"primary"}),l("createDAO.step3.existingToken.verificationLoading")]})]})},ut=d.div.attrs({className:"flex flex-col space-y-6 p-6 bg-neutral-0 rounded-xl"})``,da=d.div.attrs({className:"space-y-12"})``,ma=d.div.attrs({className:"flex py-6 text-primary-400 gap-x-2 items-center"})``,pt=d.h2.attrs({className:"ft-text-lg font-semibold text-800"})``,ua=d.div.attrs({className:"flex flex-col md:gap-x-4 gap-y-3"})``,Pe=d.dt.attrs({className:"flex items-center text-neutral-800"})``,pa=()=>{const{t}=N(),{network:l}=K(),{control:i,trigger:r,clearErrors:a,setValue:n,resetField:o}=E(),[c,x]=Y({name:["tokenAddress","blockchain"]}),s=Jt.getRpcProvider(x.id),p=M[l].nativeCurrency,h=M[l].explorer+"token/",g=Yt("token-voting.plugin.dao.eth");j.useEffect(()=>{x.id&&c.address!==""&&r("tokenAddress")},[x.id,r,p,c]);const b=j.useCallback(async m=>{a("tokenAddress"),o("tokenType"),o("tokenName"),o("tokenTotalSupply");const v=new Je(s,m.address,m.ensName),{verificationResult:D,type:k}=await Qt(v.address,s,g);if(D===!0){if(k!=="Unknown"){const{totalSupply:u,decimals:f,symbol:y,name:w}=await es(v.address,s,M[l].nativeCurrency);n("tokenName",w,{shouldDirty:!0}),n("tokenSymbol",y,{shouldDirty:!0}),n("tokenDecimals",f,{shouldDirty:!0}),n("tokenTotalSupply",Number(Ae.formatUnits(u,f)),{shouldDirty:!0})}n("tokenType",k)}return D},[a,l,g,s,o,n]);return e.jsxs(e.Fragment,{children:[e.jsxs(xt,{children:[e.jsx(ha,{children:t("createDAO.step3.existingToken.title")}),e.jsx(ga,{dangerouslySetInnerHTML:{__html:ne(t)("createDAO.step3.existingToken.description")}})]}),e.jsxs(xa,{children:[e.jsxs(xt,{children:[e.jsx(R,{label:t("createDAO.step3.existingToken.inputLabel")}),e.jsx("p",{children:e.jsx("span",{children:t("createDAO.step3.existingToken.inputDescription")})})]}),e.jsx(P,{name:"tokenAddress",control:i,defaultValue:{address:"",ensName:""},rules:{required:t("errors.required.tokenAddress"),validate:b},render:({field:{name:m,value:v,onBlur:D,onChange:k},fieldState:{error:u,isDirty:f}})=>e.jsxs(e.Fragment,{children:[e.jsx(Ze,{name:m,state:u&&"critical",value:v,onBlur:D,placeholder:"0x…",onChange:k,error:u?.message,blockExplorerURL:h}),!u?.message&&f&&v.address&&e.jsx(ca,{tokenAddress:v.address})]})})]})]})},xa=d.div.attrs({className:"space-y-3"})``,xt=d.div.attrs({className:"space-y-1"})``,ha=d.p.attrs({className:"text-xl leading-normal font-semibold text-neutral-800"})``,ga=d.p.attrs({className:"text-neutral-600 text-bold"})``,ba=({totalAddresses:t})=>{const{t:l}=N(),{getValues:i}=E(),r=i("tokenTotalSupply"),a=t===1?`1 ${l("labels.whitelistWallets.address")}`:l("labels.whitelistWallets.addresses",{count:t});return e.jsxs(ka,{children:[e.jsx(ht,{children:e.jsx(R,{label:a})}),e.jsx(ht,{children:e.jsx(gt,{children:r})}),e.jsx(fa,{children:e.jsx(gt,{children:"100%"})}),e.jsx("div",{className:"w-16"})]})},ka=d.div.attrs({className:"hidden md:flex p-4 space-x-4 bg-neutral-0"})``,ht=d.div.attrs({className:"flex-1"})``,fa=d.div.attrs({className:"w-16"})``,gt=d.p.attrs({className:"font-semibold text-neutral-800 text-right"})``,ja=()=>{const{t}=N();return e.jsxs(va,{children:[e.jsx(ya,{children:e.jsx(R,{label:t("labels.whitelistWallets.address")})}),e.jsx("div",{className:"w-[200px]",children:e.jsx(R,{label:t("finance.tokens")})}),e.jsx("div",{className:"w-20",children:e.jsx(R,{label:t("finance.allocation")})}),e.jsx("div",{className:"w-12"})]})},va=d.div.attrs({className:"hidden md:flex p-4 space-x-4 bg-neutral-0"})``,ya=d.div.attrs({className:"flex-1"})``,Aa=({index:t,onDelete:l})=>{const{t:i}=N(),{alert:r}=ge(),{api:a}=Xe(),{control:n,getValues:o,setValue:c,trigger:x}=E(),s=Y({name:"wallets",control:n}),[p,h]=j.useState(!1),g=j.useCallback(k=>{let u=0;if(s?.forEach(y=>{Number(y.amount)>0&&(u=Number(y.amount)+u)}),k<0)return"";const f=Math.floor(k/u*100);return u&&!isNaN(f)?f+"%":""},[s]),b=j.useCallback(async({address:k,ensName:u},f)=>{const y=new Je(a,k,u);let w=await Qe(y,i("errors.required.walletAddress"),i);return h(!1),s?.some((A,W)=>(A.address===y.address||A.ensName===y.ensName)&&W!==f)&&(h(!0),w=i("errors.duplicateAddress")),w},[a,i,s]),m=j.useCallback(k=>{let u=0,f=s[0]?.amount;const y=o(`wallets.${t}.address`),w=o("eligibilityType");return y===""&&x(`wallets.${t}.address`),s.forEach(A=>{Number(A.amount)<Number(f)&&(f=A.amount),Number(A.amount)>0&&(u=Number(A.amount)+u)}),c("tokenTotalSupply",u),w==="token"&&c("minimumTokenAmount",f),k.split(".")[1]?.length>rt?i("errors.exceedsFractionalParts",{decimals:rt}):lt(k).gt(ks.toString())?i("errors.ltAmount",{amount:"~ 2.69 * 10^49"}):lt(k).lte(0)?i("errors.lteZero"):u===0?i("errors.totalSupplyZero"):!0},[o,t,c,i,x,s]),v=j.useCallback((k,u)=>{u({...k,amount:s[t].amount})},[t,s]),D=j.useCallback(()=>{if(typeof l=="function"){const[k,u,f,y]=o(["tokenTotalSupply",`wallets.${t}.amount`,"eligibilityType","eligibilityTokenAmount"]),w=Number(k)-Number(u);if(c("tokenTotalSupply",w<0?0:w),l(t),f==="token"&&y===u){let A=s[0]?.amount;s.forEach((W,B)=>{B!==t&&Number(W.amount)<Number(A)&&(A=W.amount)}),c("minimumTokenAmount",A)}r(i("alert.chip.removedAddress"))}},[r,o,t,l,c,i,s]);return e.jsxs(wa,{"data-testid":"wallet-row",children:[e.jsx(P,{defaultValue:{address:"",ensName:""},name:`wallets.${t}`,control:n,rules:{validate:k=>b(k,t)},render:({field:{name:k,ref:u,value:f,onBlur:y,onChange:w},fieldState:{error:A}})=>e.jsxs(Na,{children:[e.jsx($e,{children:e.jsx(R,{label:i("labels.whitelistWallets.address")})}),e.jsx(Va,{children:e.jsx(Ze,{state:A&&"critical",value:f,onBlur:y,onChange:W=>v(W,w),error:A?.message,resolveLabels:"onBlur",ref:u,name:k})})]})}),e.jsx(P,{name:`wallets.${t}.amount`,control:n,rules:{required:i("errors.required.amount"),validate:m},defaultValue:1,render:({field:k,fieldState:{error:u}})=>e.jsxs(Da,{children:[e.jsx($e,{children:e.jsx(R,{label:i("finance.tokens")})}),e.jsx(ts,{name:k.name,onBlur:k.onBlur,onChange:k.onChange,placeholder:"1",min:1,includeDecimal:!0,disabled:p,mode:u?.message?"critical":"default",value:k.value}),u?.message&&e.jsx(Sa,{children:e.jsx(ue,{message:u.message,variant:"critical"})})]})}),e.jsx(Ea,{}),e.jsxs(Ta,{children:[e.jsx($e,{children:e.jsx(R,{label:i("finance.allocation")})}),e.jsx(Ca,{name:`wallets.${t}.amount`,value:g(Number(s[t].amount)),mode:"default",disabled:!0})]}),e.jsx(Oa,{children:e.jsx(X.Container,{align:"start",customTrigger:e.jsx(ie,{variant:"tertiary",size:"lg",iconLeft:pe.DOTS_VERTICAL,"data-testid":"trigger"}),children:e.jsx(X.Item,{disabled:typeof l!="function",onClick:D,children:i("labels.removeWallet")})})})]})},wa=d.div.attrs({className:"flex flex-wrap gap-x-4 gap-y-3 p-4 bg-neutral-0"})``,Ca=d(Ue).attrs({className:"text-right"})``,Ta=d.div.attrs({className:"order-5 md:order-4 w-20"})``,$e=d.div.attrs({className:"md:hidden mb-1"})``,Na=d.div.attrs({className:"flex-1 order-1"})``,Da=d.div.attrs({className:"flex-1 md:flex-none order-4 md:order-2 w-[200px]"})``,Sa=d.div.attrs({className:"mt-1"})``,Ea=d.hr.attrs({className:"order-3 md:hidden w-full border-0"})``,Oa=d.div.attrs({className:"flex order-2 md:order-5 mt-7 md:mt-0 w-12"})``,Va=d.div.attrs(()=>({className:"space-y-2"}))``,La=()=>{const{t}=N(),{alert:l}=ge(),i=j.useRef(!0),{network:r}=K(),{address:a}=he(),{data:n}=Ye({address:a,chainId:M[r].id}),{control:o,setValue:c,resetField:x,trigger:s}=E(),p=Y({name:"wallets",control:o}),{fields:h,append:g,remove:b}=me({name:"wallets",control:o}),m=h.map((u,f)=>({...u,...p&&{...p[f]}}));j.useEffect(()=>{a&&m?.length===0&&i.current===!0&&(g({address:a,amount:"1",ensName:n}),i.current=!1,setTimeout(()=>{s("wallets.0")},50))},[a,g,m?.length,n,s]);const v=()=>{m.forEach((u,f)=>{c(`wallets.${f}.amount`,"1")}),s("wallets"),x("eligibilityTokenAmount"),l(t("alert.chip.distributionReset"))},D=()=>{g({address:"",ensName:"",amount:"1"}),setTimeout(()=>{s(`wallets.${m.length}`)},50)},k=u=>{b(u),setTimeout(()=>{s("wallets")},50)};return e.jsxs(Ia,{"data-testid":"add-wallets",children:[e.jsxs(Ma,{children:[e.jsx(ja,{}),m.map((u,f)=>e.jsx(Aa,{index:f,onDelete:k},u.id)),e.jsx(ba,{totalAddresses:h.length||0})]}),e.jsxs(Wa,{children:[e.jsx(ie,{variant:"tertiary",size:"lg",onClick:D,children:t("labels.addWallet")}),e.jsxs(X.Container,{align:"start",customTrigger:e.jsx(ie,{variant:"tertiary",size:"lg",iconLeft:pe.DOTS_VERTICAL,"data-testid":"trigger"}),children:[e.jsx(X.Item,{onClick:v,children:t("labels.resetDistribution")}),e.jsx(X.Item,{onClick:()=>{b(),c("tokenTotalSupply",0),x("eligibilityTokenAmount"),l(t("alert.chip.removedAllAddresses"))},children:t("labels.deleteAllAddresses")})]})]})]})},Ia=d.div.attrs({className:"space-y-3"})``,Ma=d.div.attrs({className:"flex flex-col overflow-hidden space-y-0.5 rounded-xl"})``,Wa=d.div.attrs({className:"flex justify-between"})``,Ra=()=>{const{t}=N(),{control:l}=E();return e.jsxs(e.Fragment,{children:[e.jsxs(bt,{children:[e.jsx(_a,{children:t("labels.mintToken")}),e.jsx(Fa,{dangerouslySetInnerHTML:{__html:ne(t)("createDAO.step3.createTokenHelptext")}})]}),e.jsxs(He,{children:[e.jsx(R,{label:t("labels.tokenName"),helpText:t("createDAO.step3.nameSubtitle")}),e.jsx(P,{name:"tokenName",control:l,defaultValue:"",rules:{required:t("errors.required.tokenName"),validate:i=>ot(i,t("errors.fields.tokenName"))},render:({field:{onBlur:i,onChange:r,value:a,name:n},fieldState:{error:o}})=>e.jsxs(e.Fragment,{children:[e.jsx(Ue,{name:n,value:a,onBlur:i,onChange:r}),o?.message&&e.jsx(ue,{message:o.message,variant:"critical"})]})})]}),e.jsxs(He,{children:[e.jsx(R,{label:t("labels.tokenSymbol"),helpText:t("createDAO.step3.symbolSubtitle")}),e.jsx(P,{name:"tokenSymbol",control:l,defaultValue:"",rules:{required:t("errors.required.tokenSymbol"),validate:i=>ot(i,t("errors.fields.tokenSymbol"))},render:({field:{onBlur:i,onChange:r,value:a,name:n},fieldState:{error:o}})=>e.jsxs(e.Fragment,{children:[e.jsx(Ue,{name:n,value:a,onBlur:i,onChange:r}),o?.message&&e.jsx(ue,{message:o.message,variant:"critical"})]})})]}),e.jsxs(He,{children:[e.jsx(bt,{children:e.jsx(R,{label:t("labels.distributeTokens"),helpText:ne(t)("createDAO.step3.distributeTokensHelpertext"),renderHtml:!0})}),e.jsx(ue,{message:t("createDAO.step3.distributionWalletAlertText"),variant:"info"}),e.jsx(La,{})]})]})},He=d.div.attrs({className:"space-y-3"})``,bt=d.div.attrs({className:"space-y-1"})``,_a=d.p.attrs({className:"text-xl leading-normal font-semibold text-neutral-800"})``,Fa=d.p.attrs({className:"text-neutral-600 text-bold"})``,Pa=({onChange:t,value:l})=>{const{t:i}=N(),{getValues:r}=E(),{blockchain:a}=r(),n=ss(a.id);return e.jsxs(e.Fragment,{children:[e.jsx(we,{label:i("createDAO.step3.blockChainVoting.optionGaslessLabel"),helptext:i("createDAO.step3.blockChainVoting.optionGaslessDesc",{blockchainName:a.label}),onClick:()=>{t("gasless")},multiSelect:!1,disabled:!n,...l==="gasless"?{type:"active"}:{}}),!n&&e.jsx(ue,{message:i("createDAO.step3.votingType.gasless.soon",{blockchainName:a.label}),variant:"info"})]})},$a=()=>{const{t}=N(),{control:l,resetField:i,setValue:r,getValues:a}=E(),[n,o]=Y({control:l,name:["membership","isCustomToken"]}),{blockchain:c}=a(),x=[{label:t("labels.no"),selectValue:!0},{label:t("labels.yes"),selectValue:!1}];let s=!1;const p=Ke(c.id);p&&(s=!!(n==="token"&&At.getValue("VITE_FEATURE_FLAG_GASLESS_PLUGIN")==="true"&&as.includes(p)));const h=()=>{i("tokenName"),i("tokenSymbol"),i("tokenAddress"),i("tokenTotalSupply"),i("wallets")},g=()=>{i("multisigWallets")},b=(m,v)=>{m!==n&&(h(),g(),r("votingType","onChain"),m==="token"?r("eligibilityType","token"):r("eligibilityType","multisig"),v(m))};return e.jsxs(e.Fragment,{children:[e.jsxs(kt,{children:[e.jsx(R,{label:t("createDAO.step3.membership")}),e.jsx(P,{name:"membership",rules:{required:"Validate"},control:l,defaultValue:"token",render:({field:{onChange:m,value:v}})=>e.jsxs(e.Fragment,{children:[e.jsx(we,{label:t("createDAO.step3.tokenMembership"),helptext:t("createDAO.step3.tokenMembershipSubtitle"),multiSelect:!1,onClick:()=>b("token",m),...v==="token"?{type:"active"}:{}}),e.jsx(we,{label:t("createDAO.step3.multisigMembership"),helptext:t("createDAO.step3.multisigMembershipSubtitle"),onClick:()=>b("multisig",m),multiSelect:!1,...v==="multisig"?{type:"active"}:{}})]})})]}),s&&e.jsxs(ct,{children:[e.jsx(R,{label:t("createDAO.step3.blockChainVoting.label")}),e.jsx(P,{name:"votingType",rules:{required:"Validate"},control:l,defaultValue:"onChain",render:({field:{onChange:m,value:v}})=>e.jsxs(e.Fragment,{children:[e.jsx(we,{label:t("createDAO.step3.blockChainVoting.optionOnchainLabel",{blockchainName:c.label}),helptext:t("createDAO.step3.blockChainVoting.optionOnchainDesc",{blockchainName:c.label}),multiSelect:!1,onClick:()=>{m("onChain")},...v==="onChain"?{type:"active"}:{}}),e.jsx(Pa,{onChange:()=>{m("gasless")},value:v})]})})]}),n==="multisig"&&e.jsx(kt,{children:e.jsx(ra,{})}),n==="token"&&e.jsxs(e.Fragment,{children:[e.jsxs(ct,{children:[e.jsx(R,{label:t("createDAO.step3.existingToken.questionLabel")}),e.jsx(P,{name:"isCustomToken",rules:{required:"Validate"},control:l,defaultValue:!0,render:({field:{value:m,onChange:v}})=>e.jsx(os,{items:x,value:m,onChange:v})})]}),o?e.jsx(Ra,{}):e.jsx(pa,{})]})]})},kt=d.div.attrs({className:"space-y-3"})``,Ha=()=>{const{t}=N(),{alert:l}=ge(),i=j.useRef(!0),{network:r}=K(),{address:a}=he(),{data:n}=Ye({address:a,chainId:M[r].id}),{control:o,setFocus:c,trigger:x}=E(),s=Y({name:"committee",control:o}),{fields:p,append:h,remove:g}=me({name:"committee",control:o}),b=p.map((u,f)=>({...u,...s&&{...s[f]}}));j.useEffect(()=>{a&&p?.length===0&&i.current&&(h({address:a,amount:"1",ensName:n}),i.current=!1)},[a,h,p?.length,n,x]);const m=()=>{h({address:"",ensName:"",amount:1}),l(t("alert.chip.addressAdded"));const u=`committee.${p.length}`;setTimeout(()=>{c(u),x(u)},50)},v=u=>{g(u),l(t("alert.chip.removedAddress")),setTimeout(()=>{x("committee")})},D=()=>{g(),l(t("alert.chip.removedAllAddresses")),setTimeout(()=>{x("multisigWallets")},50)},k=async(u,f)=>{let y=await Qe(u,t("errors.required.walletAddress"),t);return y&&y!==!0||s&&s.forEach(({address:w,ensName:A},W)=>{(u.address&&w.toLowerCase()===u.address.toLowerCase()||u.ensName&&A.toLowerCase()===u.ensName.toLowerCase())&&W!==f&&(y=t("errors.duplicateAddress"))}),y};return e.jsxs(Ga,{children:[e.jsx(Ct,{controlledWallets:b,handleAdd:m,handleDeleteEntry:v,handleDeleteAll:D,rowValidator:k,walletFieldName:"committee"}),e.jsx(ue,{message:t("createDAO.step3.distributionWalletAlertText"),variant:"info"})]})},Ga=d.div.attrs(()=>({className:"space-y-3 flex flex-col"}))``,Ba=1,Ua=()=>{const{t}=N(),{control:l,setValue:i,trigger:r}=E(),[a,n]=Y({name:["committee","committeeMinimumApproval"]}),o=a?.length??0,c=s=>s>o?t("errors.minimumApproval.exceedMaxThreshold"):s<=0?t("errors.required.minApproval"):!0,x=j.useCallback((s,p)=>{Number(s.target.value)>o&&(i("committeeMinimumApproval",o.toString()),s.target.value=o),r(["committeeMinimumApproval"]),p(s)},[o,i,r]);return j.useEffect(()=>{(Number(n)===0&&o===1||Number(n)>o)&&i("committeeMinimumApproval",o.toString())},[o,n,i]),e.jsxs(e.Fragment,{children:[e.jsxs(ft,{children:[e.jsx(R,{label:t("createDao.executionMultisig.membersLabel"),helpText:t("createDao.executionMultisig.membersDesc")}),e.jsx(Ha,{})]}),e.jsxs(ft,{children:[e.jsx(R,{label:t("labels.minimumApproval"),helpText:t("createDAO.step4.minimumApprovalSubtitle")}),e.jsx(P,{name:"committeeMinimumApproval",control:l,defaultValue:"1",rules:{required:t("errors.required.amount"),validate:s=>c(s)},render:({field:{onBlur:s,onChange:p,value:h,name:g},fieldState:{error:b}})=>e.jsx(e.Fragment,{children:e.jsx(fs,{name:g,value:h,min:Ba,max:o,onBlur:s,onChange:m=>x(m,p),error:js(h,a.length,t,b)})})})]}),e.jsx(cs,{})]})},ft=d.div.attrs({className:"space-y-1.5"})``;d.div.attrs({className:"flex flex-col xl:flex-row items-center p-4 pt-8 xl:p-6 gap-x-6 gap-y-8 rounded-xl bg-neutral-0"})``;d.div.attrs({className:"flex relative flex-1 items-center"})``;d.div.attrs({className:"flex absolute whitespace-nowrap -top-5 justify-between space-x-1 w-full text-sm leading-normal "})``;d.p.attrs({className:"font-semibold text-right text-primary-500"})``;d.p.attrs({className:"text-neutral-600 ft-text-sm"})``;d.div.attrs({className:"order-2 xl:order-1 w-full xl:w-1/4"})``;d.div.attrs({className:"flex flex-1 xl:order-2 items-center w-full"})``;const qa={tokenName:"",tokenAddress:{address:"",ensName:""},tokenSymbol:"",tokenDecimals:18,tokenTotalSupply:1,tokenTotalHolders:void 0,tokenType:void 0,links:[{name:"",url:""}],earlyExecution:!0,voteReplacement:!1,membership:"token",eligibilityType:"token",eligibilityTokenAmount:1,minimumTokenAmount:1,isCustomToken:!0,durationDays:"1",durationHours:"0",durationMinutes:"0",minimumParticipation:"15"},ln=()=>{const{t}=N(),{chainId:l}=he(),{api:i}=Xe(),{setNetwork:r,isL2Network:a}=K(),n=ns({mode:"onChange",defaultValues:qa}),{update:o}=me({control:n.control,name:"multisigWallets"}),{update:c}=me({name:"wallets",control:n.control}),{update:x}=me({name:"committee",control:n.control}),{errors:s,dirtyFields:p}=is({control:n.control}),[h,g,b,m,v,D,k,u,f,y,w,A,W,B,J]=Y({control:n.control,name:["blockchain.id","daoName","daoEnsName","eligibilityType","isCustomToken","tokenAddress","tokenName","tokenSymbol","membership","multisigWallets","wallets","tokenTotalSupply","tokenType","committee","votingType"]}),re=j.useRef(h);j.useEffect(()=>{const O=Ke(l)||"ethereum";r(O),n.setValue("blockchain",{id:M[O].id,label:M[O].name,network:M[O].isTestnet?"test":"main"})},[]),j.useEffect(()=>{const O=async()=>{y&&Ge(y,i,o),w&&Ge(w,i,c),B&&Ge(w,i,x)};re.current!==h&&(re.current=h,O())},[h]);const Q=(O,Ve,Le)=>{de("daoCreation_continueBtn",{step:Ve,settings:Le}),O()},Ne=()=>y?.length>0&&ae(s.multisigWallets)&&["anyone","multisig"].includes(m),De=()=>w?.length>0&&ae(s.wallets)&&be(k)&&ae(s.tokenName)&&be(u)&&ae(s.tokenSymbol)&&["anyone","token"].includes(m)&&ae(s.eligibilityTokenAmount)&&A>0,je=()=>be(D?.address)&&ae(s.tokenAddress?.address)&&be(k)&&ae(s.tokenName)&&be(W)&&ae(s.tokenType)&&W!=="Unknown"&&A>0,Se=j.useMemo(()=>!a&&!b||!g||!p.daoSummary?!1:!(s.daoEnsName||s.daoName||s.links||s.daoSummary),[b,g,p.daoSummary,s.daoEnsName,s.daoName,s.daoSummary,s.links,a]);let ee=!1;switch(f){case"multisig":ee=Ne();break;case"token":ee=v?De():je();break}const Ee=j.useMemo(()=>!(!B||!B.length||s.committee||s.committeeMinimumApproval||s.executionExpirationMinutes||s.executionExpirationHours||s.executionExpirationDays),[B,s.committee,s.committeeMinimumApproval,s.executionExpirationMinutes,s.executionExpirationHours,s.executionExpirationDays]),Oe=j.useMemo(()=>!(s.minimumApproval||s.minimumParticipation||s.support||s.durationDays||s.durationHours||s.durationMinutes||s.multisigMinimumApprovals||s.eligibilityTokenAmount),[s.durationDays,s.durationHours,s.durationMinutes,s.minimumApproval,s.minimumParticipation,s.support,s.multisigMinimumApprovals,s.eligibilityTokenAmount]);return e.jsx(rs,{...n,children:e.jsx(Ws,{children:e.jsxs(ls,{wizardProcessName:t("createDAO.title"),navLabel:t("createDAO.title"),returnPath:Be,processType:"DaoCreation",children:[e.jsx(ce,{fullWidth:!0,hideWizard:!0,customHeader:e.jsx(Ns,{navLabel:t("createDAO.title"),returnPath:Be}),customFooter:e.jsx(e.Fragment,{}),children:e.jsx(Ds,{})}),e.jsx(ce,{wizardTitle:t("createDAO.step1.title"),wizardDescription:ne(t)("createDAO.step1.description"),wizardDescriptionLink:t("createDAO.step1.descriptionLinkURL"),onNextButtonClicked:O=>Q(O,"1_select_blockchain",{network:n.getValues("blockchain")?.network}),children:e.jsx(Gs,{})}),e.jsx(ce,{wizardTitle:t("createDAO.step2.title"),wizardDescription:ne(t)("createDAO.step2.description"),wizardDescriptionLink:t("createDAO.step2.descriptionLinkURL"),isNextButtonDisabled:!Se,onNextButtonClicked:O=>Q(O,"2_define_metadata",{dao_name:n.getValues("daoName"),links:n.getValues("links")}),children:e.jsx(ds,{})}),e.jsx(ce,{wizardTitle:t("createDAO.step3.title"),wizardDescription:ne(t)("createDAO.step3.description"),wizardDescriptionLink:t("createDAO.step3.descriptionLinkURL"),isNextButtonDisabled:!ee,onNextButtonClicked:O=>Q(O,"3_setup_community",{governance_type:n.getValues("membership"),voting_type:n.getValues("votingType"),token_name:n.getValues("tokenName"),symbol:n.getValues("tokenSymbol"),token_address:n.getValues("tokenAddress.address"),multisigWallets:n.getValues("multisigWallets")}),children:e.jsx($a,{})}),e.jsx(ce,{wizardTitle:t("createDAO.step4.title"),wizardDescription:ne(t)("createDAO.step4.description"),wizardDescriptionLink:t("createDAO.step4.descriptionLinkURL"),isNextButtonDisabled:!Oe,onNextButtonClicked:O=>Q(O,"4_configure_governance",{minimum_approval:n.getValues("minimumApproval"),support:n.getValues("support"),duration_days:n.getValues("durationDays"),duration_hours:n.getValues("durationHours"),duration_minutes:n.getValues("durationMinutes"),governance_type:n.getValues("membership")}),children:e.jsx(ms,{})}),e.jsx(ce,{skipStep:J!=="gasless",wizardTitle:t("createDao.executionMultisig.title"),wizardDescription:ne(t)("createDao.executionMultisig.desc"),isNextButtonDisabled:!Ee,onNextButtonClicked:O=>{Q(O,"5_define_execution_multisig",{committee:n.getValues("committee"),committeeMinimumApproval:n.getValues("committeeMinimumApproval"),executionExpirationMinutes:n.getValues("executionExpirationMinutes"),executionExpirationHours:n.getValues("executionExpirationHours"),executionExpirationDays:n.getValues("executionExpirationDays")})},children:e.jsx(Ua,{})}),e.jsx(ce,{hideWizard:!0,fullWidth:!0,customHeader:e.jsx(_s,{}),customFooter:e.jsx(Ps,{}),children:e.jsx(Fs,{})})]})})})},Ge=async(t,l,i)=>{const r=await Promise.all(t.map(a=>l.lookupAddress(a.address)));t.forEach((a,n)=>{i(n,{...a,ensName:r[n]??""})})};export{ln as CreateDAO};
